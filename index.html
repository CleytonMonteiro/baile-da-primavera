<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AABB ARACAJU - 80 ANOS</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .legenda {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        .legenda-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            color: #555;
        }

        .legenda-cor {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .layout-salão {
            width: 100%;
            max-width: 1400px;
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .scroll-container {
            display: flex;
            justify-content: center;
            gap: 50px;
            width: 100%;
        }

        @media (max-width: 768px) {
            .scroll-container {
                display: grid;
                grid-auto-flow: column;
                grid-auto-columns: min-content;
                gap: 20px;
                overflow-x: auto;
                justify-content: flex-start;
                width: 100%;
                padding: 0 10px;
            }
        }

        .secao-mesas {
            display: flex;
            gap: 10px;
        }

        .coluna-mesas {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .secao-centro {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: flex-start;
            gap: 10px;
        }
        
        .mesa {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ccc;
            border-radius: 4px;
            color: #333;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            background-color: #f9f9f9;
            position: relative;
            flex-shrink: 0;
        }
        
        .mesa:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            z-index: 1000;
        }

        .mesa[data-tooltip]:hover::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            white-space: nowrap;
            font-size: 0.8em;
            font-weight: normal;
        }

        .livre {
            background-color: #28a745;
            color: white;
        }

        .reservada {
            background-color: #ffc107;
            color: #333;
        }

        .vendida {
            background-color: #dc3545;
            color: white;
        }

        /* ESTILOS ADICIONAIS PARA OS NOVOS FORMULÁRIOS */
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            flex-direction: column;
            gap: 15px;
        }
        
        .modal.alerta-erro {
            border: 2px solid #dc3545;
        }
        
        .modal h2 {
            margin-top: 0;
            color: #333;
        }
        
        .modal label {
            font-weight: bold;
            color: #555;
        }

        .modal input, .modal select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        
        .modal button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            color: white;
            transition: background-color 0.2s;
        }

        #login-btn, #salvar-btn {
            background-color: #007bff;
        }

        #login-btn:hover, #salvar-btn:hover {
            background-color: #0056b3;
        }

        .botoes-form {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        #cancelar-btn {
            background-color: #6c757d;
        }
        
        #cancelar-btn:hover {
            background-color: #5a6268;
        }
        
        #mensagem-erro {
            color: #dc3545;
            font-size: 0.9em;
            margin-top: -10px;
            display: none;
        }

        #auth-status {
            position: absolute;
            top: 20px;
            right: 20px;
            font-weight: bold;
            color: #555;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #logout-btn {
            background-color: #dc3545;
            border: none;
            color: white;
            padding: 8px 12px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
        }

        #logout-btn:hover {
            background-color: #a71d2a;
        }
    </style>
</head>
<body>

    <h1>BAILE DA PRIMAVERA</h1>

    <div id="auth-status">
        <span id="status-text">Faça login para gerenciar as mesas.</span>
        <button id="logout-btn" style="display: none;">Sair</button>
    </div>

    <div class="legenda">
        <div class="legenda-item">
            <div class="legenda-cor" style="background-color: #28a745;"></div>
            <span>Livre</span>
        </div>
        <div class="legenda-item">
            <div class="legenda-cor" style="background-color: #ffc107;"></div>
            <span>Reservada</span>
        </div>
        <div class="legenda-item">
            <div class="legenda-cor" style="background-color: #dc3545;"></div>
            <span>Vendida</span>
        </div>
    </div>

    <div class="layout-salão">
        
        <div class="scroll-container">
            <div class="secao-mesas" id="secao-esquerda">
                <div class="coluna-mesas" id="col-esq-1"></div>
                <div class="coluna-mesas" id="col-esq-2"></div>
                <div class="coluna-mesas" id="col-esq-3"></div>
                <div class="coluna-mesas" id="col-esq-4"></div>
            </div>

            <div class="secao-centro" id="secao-centro">
                <div class="coluna-mesas" id="col-cen-1"></div>
                <div class="coluna-mesas" id="col-cen-2"></div>
                <div class="coluna-mesas" id="col-cen-3"></div>
                <div class="coluna-mesas" id="col-cen-4"></div>
                <div class="coluna-mesas" id="col-cen-5"></div>
                <div class="coluna-mesas" id="col-cen-6"></div>
                <div class="coluna-mesas" id="col-cen-7"></div>
            </div>
            
            <div class="secao-mesas" id="secao-direita">
                <div class="coluna-mesas" id="col-dir-1"></div>
                <div class="coluna-mesas" id="col-dir-2"></div>
                <div class="coluna-mesas" id="col-dir-3"></div>
                <div class="coluna-mesas" id="col-dir-4"></div>
                <div class="coluna-mesas" id="col-dir-5"></div>
                <div class="coluna-mesas" id="col-dir-6"></div>
            </div>
        </div>
    </div>

    <div id="login-form" class="modal">
        <h2>Login do Supervisor</h2>
        <label for="login-email">E-mail:</label>
        <input type="email" id="login-email" placeholder="E-mail de supervisor" required>
        
        <label for="login-senha">Senha:</label>
        <input type="password" id="login-senha" placeholder="Senha" required>
        <span id="login-erro" style="color: red; display: none;">E-mail ou senha incorretos.</span>

        <button id="login-btn">Entrar</button>
    </div>

    <div id="cadastro-form" class="modal">
        <h2>Cadastro de Mesa</h2>
        <input type="hidden" id="mesa-numero">
        
        <label for="nome-completo">Nome Completo:</label>
        <input type="text" id="nome-completo" placeholder="Digite o nome completo" required>
        
        <label for="status-mesa">Status:</label>
        <select id="status-mesa">
            <option value="livre">Livre</option>
            <option value="reservada">Reservada</option>
            <option value="vendida">Vendida</option>
        </select>
        
        <div class="botoes-form">
            <button id="salvar-btn">Salvar</button>
            <button id="cancelar-btn">Cancelar</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getDatabase, ref, onValue, set, child } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDGVgqwdSOJJn0plwfKkHEsofxvfHFCf6w",
            authDomain: "layoutsalaodefesta.firebaseapp.com",
            databaseURL: "https://layoutsalaodefesta-default-rtdb.firebaseio.com",
            projectId: "layoutsalaodefesta",
            storageBucket: "layoutsalaodefesta.firebasestorage.app",
            messagingSenderId: "1060371531536",
            appId: "1:1060371531536:web:fbed496ff9a78982580795",
            measurementId: "G-L21G98V5CL"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);
        const mesasRef = ref(database, 'mesas');
        const auth = getAuth(app);

        document.addEventListener('DOMContentLoaded', () => {
            const loginForm = document.getElementById('login-form');
            const loginEmailInput = document.getElementById('login-email');
            const loginSenhaInput = document.getElementById('login-senha');
            const loginBtn = document.getElementById('login-btn');
            const loginErroSpan = document.getElementById('login-erro');
            const cadastroForm = document.getElementById('cadastro-form');
            const mesaNumeroInput = document.getElementById('mesa-numero');
            const nomeCompletoInput = document.getElementById('nome-completo');
            const statusMesaSelect = document.getElementById('status-mesa');
            const salvarBtn = document.getElementById('salvar-btn');
            const cancelarBtn = document.getElementById('cancelar-btn');
            const authStatus = document.getElementById('auth-status');
            const statusText = document.getElementById('status-text');
            const logoutBtn = document.getElementById('logout-btn');

            let isLoggedIn = false;

            // Renderiza as mesas no layout
            function renderizarMesas(mesasData) {
                document.querySelectorAll('.coluna-mesas').forEach(col => col.innerHTML = '');
                const layoutMesas = {
                    'col-esq-1': [101, 100, 99, 98, 97, 96, 95, 94],
                    'col-esq-2': [86, 87, 88, 89, 90, 91, 92, 93],
                    'col-esq-3': [85, 84, 83, 82, 81, 80, 79, 78], 
                    'col-esq-4': [70, 71, 72, 73, 74, 75, 76, 77],
                    'col-cen-1': [69, 68, 67],
                    'col-cen-2': [64, 65, 66],
                    'col-cen-3': [63, 62, 61],
                    'col-cen-4': [58, 59, 60],
                    'col-cen-5': [57, 56, 55],
                    'col-cen-6': [52, 53, 54],
                    'col-cen-7': [51, 50, 49],
                    'col-dir-1': [41, 42, 43, 44, 45, 46, 47, 48],
                    'col-dir-2': [40, 39, 38, 37, 36, 35, 34, 33],
                    'col-dir-3': [25, 26, 27, 28, 29, 30, 31, 32],
                    'col-dir-4': [24, 23, 22, 21, 20, 19, 18, 17],
                    'col-dir-5': [9, 10, 11, 12, 13, 14, 15, 16],
                    'col-dir-6': [8, 7, 6, 5, 4, 3, 2, 1]
                };
                
                for (const colId in layoutMesas) {
                    const coluna = document.getElementById(colId);
                    layoutMesas[colId].forEach(mesaNum => {
                        const mesaDiv = document.createElement('div');
                        const mesaData = mesasData[mesaNum] || { status: 'livre', nome: '' };
                        mesaDiv.classList.add('mesa', mesaData.status);
                        mesaDiv.textContent = mesaNum.toString().padStart(2, '0');
                        mesaDiv.dataset.numero = mesaNum;
                        
                        if (mesaData.status !== 'livre' && mesaData.nome) {
                            mesaDiv.setAttribute('data-tooltip', `Responsável: ${mesaData.nome}`);
                        } else {
                            mesaDiv.removeAttribute('data-tooltip');
                        }

                        mesaDiv.addEventListener('click', () => {
                            if (isLoggedIn) {
                                abrirFormulario(mesaNum, mesaData);
                            } else {
                                loginForm.style.display = 'flex';
                            }
                        });
                        
                        coluna.appendChild(mesaDiv);
                    });
                }
            }

            // Abre o formulário de cadastro de mesa
            function abrirFormulario(numero, mesaData) {
                mesaNumeroInput.value = numero;
                nomeCompletoInput.value = mesaData.nome;
                statusMesaSelect.value = mesaData.status;
                cadastroForm.style.display = 'flex';
            }

            // Lida com o login
            loginBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const email = loginEmailInput.value;
                const senha = loginSenhaInput.value;
                signInWithEmailAndPassword(auth, email, senha)
                    .then((userCredential) => {
                        console.log("Login realizado com sucesso!");
                        loginForm.style.display = 'none';
                        loginErroSpan.style.display = 'none';
                    })
                    .catch((error) => {
                        console.error("Erro de login:", error);
                        loginErroSpan.style.display = 'block';
                        loginForm.classList.add('alerta-erro');
                    });
            });

            // Lida com o logout
            logoutBtn.addEventListener('click', () => {
                signOut(auth).then(() => {
                    console.log("Logout realizado com sucesso.");
                }).catch((error) => {
                    console.error("Erro ao fazer logout:", error);
                });
            });

            // Lida com o salvamento do formulário de cadastro
            salvarBtn.addEventListener('click', () => {
                const numeroMesa = parseInt(mesaNumeroInput.value);
                const novoNome = nomeCompletoInput.value;
                const novoStatus = statusMesaSelect.value;
                
                const updateData = {
                    nome: novoNome,
                    status: novoStatus
                };
                
                set(child(mesasRef, numeroMesa.toString()), updateData)
                    .then(() => {
                        console.log("Mesa atualizada no Firebase com sucesso!");
                        cadastroForm.style.display = 'none';
                    })
                    .catch(error => {
                        console.error("Erro ao atualizar mesa no Firebase:", error);
                        alert("Erro ao salvar. Verifique a conexão com o Firebase.");
                    });
            });

            // Lida com o cancelamento do formulário de cadastro
            cancelarBtn.addEventListener('click', () => {
                cadastroForm.style.display = 'none';
            });
            
            // Monitora o estado de autenticação do usuário
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    isLoggedIn = true;
                    statusText.textContent = `Logado como: ${user.email}`;
                    logoutBtn.style.display = 'inline-block';
                } else {
                    isLoggedIn = false;
                    statusText.textContent = 'Faça login para gerenciar as mesas.';
                    logoutBtn.style.display = 'none';
                }
            });

            // Carrega os dados das mesas
            onValue(mesasRef, (snapshot) => {
                const mesasData = snapshot.val();
                if (mesasData) {
                    renderizarMesas(mesasData);
                } else {
                    console.log("Banco de dados vazio. Inicializando mesas...");
                    const layoutMesas = {
                        'col-esq-1': [101, 100, 99, 98, 97, 96, 95, 94],
                        'col-esq-2': [86, 87, 88, 89, 90, 91, 92, 93],
                        'col-esq-3': [85, 84, 83, 82, 81, 80, 79, 78], 
                        'col-esq-4': [70, 71, 72, 73, 74, 75, 76, 77],
                        'col-cen-1': [69, 68, 67],
                        'col-cen-2': [64, 65, 66],
                        'col-cen-3': [63, 62, 61],
                        'col-cen-4': [58, 59, 60],
                        'col-cen-5': [57, 56, 55],
                        'col-cen-6': [52, 53, 54],
                        'col-cen-7': [51, 50, 49],
                        'col-dir-1': [41, 42, 43, 44, 45, 46, 47, 48],
                        'col-dir-2': [40, 39, 38, 37, 36, 35, 34, 33],
                        'col-dir-3': [25, 26, 27, 28, 29, 30, 31, 32],
                        'col-dir-4': [24, 23, 22, 21, 20, 19, 18, 17],
                        'col-dir-5': [9, 10, 11, 12, 13, 14, 15, 16],
                        'col-dir-6': [8, 7, 6, 5, 4, 3, 2, 1]
                    };
                    const mesasIniciais = {};
                    for (const colId in layoutMesas) {
                        layoutMesas[colId].forEach(mesaNum => {
                            mesasIniciais[mesaNum] = { status: 'livre', nome: '' };
                        });
                    }
                    set(mesasRef, mesasIniciais)
                        .then(() => console.log("Dados iniciais das mesas salvos no Firebase."))
                        .catch(error => console.error("Erro ao salvar dados iniciais:", error));
                }
            });
        });
    </script>
</body>
</html>